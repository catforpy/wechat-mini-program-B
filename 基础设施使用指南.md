# åŸºç¡€è®¾æ–½å±‚ä½¿ç”¨æŒ‡å—

> æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†é¡¹ç›®ä¸­åŸºç¡€è®¾æ–½å±‚å„æ¨¡å—çš„ä½¿ç”¨æ–¹æ³•

**æœ€åæ›´æ–°**: 2026-02-07

---

## ğŸ“š ç›®å½•

- [ä¸€ã€HTTP è¯·æ±‚](#ä¸€-http-è¯·æ±‚)
- [äºŒã€æœ¬åœ°å­˜å‚¨](#äºŒ-æœ¬åœ°å­˜å‚¨)
- [ä¸‰ã€ç¼“å­˜ç®¡ç†](#ä¸‰-ç¼“å­˜ç®¡ç†)
- [å››ã€æœ¬åœ°æ•°æ®åº“](#å››-æœ¬åœ°æ•°æ®åº“)
- [äº”ã€å·¥å…·å‡½æ•°](#äº”-å·¥å…·å‡½æ•°)
- [å…­ã€é…ç½®ç®¡ç†](#å…­-é…ç½®ç®¡ç†)

---

## ä¸€ã€HTTP è¯·æ±‚

### 1.1 åŸºç¡€ä½¿ç”¨

```typescript
import { httpRequest } from '@/utils'

// GET è¯·æ±‚
const data = await httpRequest.get('/user/info')
console.log(data)

// POST è¯·æ±‚
const result = await httpRequest.post('/user/login', {
  username: 'admin',
  password: '123456'
})

// PUT è¯·æ±‚
await httpRequest.put('/user/update', { name: 'å¼ ä¸‰' })

// DELETE è¯·æ±‚
await httpRequest.delete('/user/delete', { id: 1 })
```

### 1.2 é«˜çº§é…ç½®

```typescript
import { httpRequest } from '@/utils'
import type { RequestConfig } from '@/types'

// å®Œæ•´é…ç½®
const response = await httpRequest.request<UserInfo>({
  url: '/user/info',
  method: 'GET',
  params: { id: 123 },
  cache: 60000, // ç¼“å­˜ 60 ç§’
  retry: 3, // å¤±è´¥é‡è¯• 3 æ¬¡
  showLoading: true,
  loadingText: 'åŠ è½½ä¸­...'
})
```

### 1.3 æ–‡ä»¶ä¸Šä¼ 

```typescript
import { httpRequest } from '@/utils'

// ä¸Šä¼ å•ä¸ªæ–‡ä»¶
const result = await httpRequest.upload('/upload', '/path/to/file.jpg')

// ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
for (const filePath of filePaths) {
  await httpRequest.upload('/upload', filePath)
}
```

### 1.4 æ–‡ä»¶ä¸‹è½½

```typescript
import { httpRequest } from '@/utils'

// ä¸‹è½½æ–‡ä»¶
const tempFilePath = await httpRequest.download('/files/document.pdf')
console.log('ä¸´æ—¶æ–‡ä»¶è·¯å¾„:', tempFilePath)
```

### 1.5 æ·»åŠ æ‹¦æˆªå™¨

```typescript
import { httpRequest } from '@/utils'

// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
httpRequest.addRequestInterceptor((config) => {
  // æ·»åŠ è‡ªå®šä¹‰ header
  config.header = {
    ...config.header,
    'X-Custom-Header': 'value'
  }
  return config
})

// æ·»åŠ å“åº”æ‹¦æˆªå™¨
httpRequest.addResponseInterceptor((response) => {
  // ç»Ÿä¸€å¤„ç†å“åº”æ•°æ®
  return response.data
})

// æ·»åŠ é”™è¯¯æ‹¦æˆªå™¨
httpRequest.addErrorInterceptor((error) => {
  console.error('è¯·æ±‚é”™è¯¯:', error)
  return error
})
```

### 1.6 ç¼“å­˜æ§åˆ¶

```typescript
import { httpRequest } from '@/utils'

// æ¸…é™¤æ‰€æœ‰ç¼“å­˜
httpRequest.clearCache()

// æ¸…é™¤æŒ‡å®š URL çš„ç¼“å­˜
httpRequest.clearUrlCache('/user/list')
```

---

## äºŒã€æœ¬åœ°å­˜å‚¨

### 2.1 åŸºç¡€ä½¿ç”¨

```typescript
import Storage from '@/utils/storage'

// è®¾ç½®æ•°æ®
await Storage.set('username', 'å¼ ä¸‰')
await Storage.set('userInfo', { id: 1, name: 'å¼ ä¸‰' })

// è·å–æ•°æ®
const username = await Storage.get('username')
const userInfo = await Storage.get<UserInfo>('userInfo')

// åŒæ­¥è·å–
const username = Storage.getSync('username')

// åˆ é™¤æ•°æ®
await Storage.remove('username')

// æ¸…ç©ºæ‰€æœ‰æ•°æ®
await Storage.clear()
```

### 2.2 è¿‡æœŸæ—¶é—´

```typescript
import Storage from '@/utils/storage'

// è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ1 å°æ—¶ï¼‰
await Storage.set('token', 'abc123', {
  expire: 60 * 60 * 1000
})

// ä½¿ç”¨é¢„å®šä¹‰çš„è¿‡æœŸæ—¶é—´
import { CACHE_TTL } from '@/config/constant'

await Storage.set('data', value, {
  expire: CACHE_TTL.LONG // 1 å°æ—¶
})
```

### 2.3 å­˜å‚¨æ£€æŸ¥

```typescript
import Storage from '@/utils/storage'

// æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨ï¼ˆå¼‚æ­¥ï¼‰
const hasToken = await Storage.has('token')

// æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨ï¼ˆåŒæ­¥ï¼‰
const hasToken = Storage.hasSync('token')

// è·å–æ‰€æœ‰é”®
const keys = Storage.keys()

// è·å–å­˜å‚¨ä¿¡æ¯
const info = Storage.getInfo()
console.log('å­˜å‚¨å¤§å°:', info.currentSize)
console.log('å­˜å‚¨é™åˆ¶:', info.limitSize)
```

---

## ä¸‰ã€ç¼“å­˜ç®¡ç†

### 3.1 LRU ç¼“å­˜

```typescript
import { CacheManager } from '@/utils'

// åˆ›å»ºç¼“å­˜å®ä¾‹
const cache = new CacheManager({
  maxSize: 100, // æœ€å¤§ç¼“å­˜æ•°é‡
  ttl: 30 * 60 * 1000 // é»˜è®¤è¿‡æœŸæ—¶é—´ 30 åˆ†é’Ÿ
})

// è®¾ç½®ç¼“å­˜
cache.set('user:1', { name: 'å¼ ä¸‰' })
cache.set('user:2', { name: 'æå››' }, 60000) // è‡ªå®šä¹‰è¿‡æœŸæ—¶é—´

// è·å–ç¼“å­˜
const user = cache.get('user:1')

// æ£€æŸ¥æ˜¯å¦å­˜åœ¨
const exists = cache.has('user:1')

// åˆ é™¤ç¼“å­˜
cache.remove('user:1')

// æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
cache.clear()

// è·å–ç¼“å­˜ç»Ÿè®¡
const stats = cache.getStats()
console.log('ç¼“å­˜ä½¿ç”¨ç‡:', stats.utilizationRate)
console.log('æœ€å¸¸è®¿é—®:', stats.mostAccessed)
console.log('å³å°†è¿‡æœŸ:', stats.expiringSoon)
```

### 3.2 ç®€å•ç¼“å­˜

```typescript
import { SimpleCache } from '@/utils'

const cache = new SimpleCache()

// ä½¿ç”¨æ–¹æ³•ä¸ CacheManager ç›¸åŒ
cache.set('key', 'value', 60000)
const value = cache.get('key')
```

### 3.3 å…¨å±€ç¼“å­˜å®ä¾‹

```typescript
import { globalCache } from '@/utils'

// ä½¿ç”¨å…¨å±€ç¼“å­˜å®ä¾‹
globalCache.set('api:data', responseData, 30000)
const data = globalCache.get('api:data')
```

---

## å››ã€æœ¬åœ°æ•°æ®åº“

### 4.1 æ‰“å¼€æ•°æ®åº“

```typescript
import { database } from '@/utils/database'

// å®šä¹‰æ•°æ®åº“é…ç½®
const config = {
  name: 'my_app_db',
  version: 1,
  tables: [
    {
      name: 'users',
      columns: [
        { name: 'id', type: 'INTEGER', primaryKey: true, autoIncrement: true },
        { name: 'username', type: 'TEXT', notNull: true, unique: true },
        { name: 'password', type: 'TEXT', notNull: true },
        { name: 'nickname', type: 'TEXT' },
        { name: 'email', type: 'TEXT' },
        { name: 'create_time', type: 'INTEGER' }
      ],
      indexes: [
        { name: 'idx_username', columns: ['username'], unique: true },
        { name: 'idx_email', columns: ['email'] }
      ]
    },
    {
      name: 'orders',
      columns: [
        { name: 'id', type: 'INTEGER', primaryKey: true, autoIncrement: true },
        { name: 'user_id', type: 'INTEGER', notNull: true },
        { name: 'order_no', type: 'TEXT', notNull: true },
        { name: 'amount', type: 'REAL' },
        { name: 'status', type: 'TEXT' },
        { name: 'create_time', type: 'INTEGER' }
      ]
    }
  ]
}

// æ‰“å¼€æ•°æ®åº“
await database.open(config)
```

### 4.2 å¢åˆ æ”¹æŸ¥

```typescript
import { database } from '@/utils/database'

// æ’å…¥å•æ¡æ•°æ®
await database.insert('users', {
  username: 'zhangsan',
  password: '123456',
  nickname: 'å¼ ä¸‰',
  email: 'zhangsan@example.com',
  create_time: Date.now()
})

// æ‰¹é‡æ’å…¥æ•°æ®
await database.batchInsert('users', [
  { username: 'lisi', password: '123456', nickname: 'æå››' },
  { username: 'wangwu', password: '123456', nickname: 'ç‹äº”' }
])

// æŸ¥è¯¢æ•°æ®
const users = await database.select<User>('users', {
  where: { status: 'active' },
  orderBy: 'create_time',
  order: 'DESC',
  limit: 10
})

// æ›´æ–°æ•°æ®
await database.update('users',
  { nickname: 'å¼ ä¸‰ä¸‰' },
  { id: 1 }
)

// åˆ é™¤æ•°æ®
await database.delete('users', { id: 1 })
```

### 4.3 é«˜çº§æŸ¥è¯¢

```typescript
import { database } from '@/utils/database'

// ç»Ÿè®¡æ•°é‡
const count = await database.count('users', { status: 'active' })

// æ£€æŸ¥æ˜¯å¦å­˜åœ¨
const exists = await database.exists('users', { username: 'zhangsan' })

// åˆ†é¡µæŸ¥è¯¢
const page = 1
const pageSize = 20
const users = await database.select('users', {
  limit: pageSize,
  offset: (page - 1) * pageSize
})

// è·å–è¡¨åˆ—è¡¨
const tables = await database.getTables()

// è·å–è¡¨ç»“æ„
const schema = await database.getTableSchema('users')
```

### 4.4 äº‹åŠ¡æ“ä½œ

```typescript
import { database } from '@/utils/database'

await database.transaction(async () => {
  // è¿™äº›æ“ä½œä¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œ
  await database.insert('orders', { order_no: 'ORD001', amount: 100 })
  await database.update('users', { balance: 900 }, { id: 1 })

  // å¦‚æœæŠ›å‡ºé”™è¯¯ï¼Œäº‹åŠ¡ä¼šå›æ»š
  // if (someError) throw new Error('æ“ä½œå¤±è´¥')
})
```

---

## äº”ã€å·¥å…·å‡½æ•°

### 5.1 é˜²æŠ–ä¸èŠ‚æµ

```typescript
import { debounce, throttle, rafThrottle } from '@/utils'

// é˜²æŠ–ï¼ˆæœç´¢æ¡†è¾“å…¥ï¼‰
const handleSearch = debounce((keyword: string) => {
  console.log('æœç´¢:', keyword)
}, 500)

// èŠ‚æµï¼ˆæ»šåŠ¨äº‹ä»¶ï¼‰
const handleScroll = throttle(() => {
  console.log('æ»šåŠ¨ä¸­...')
}, 100)

// RAF èŠ‚æµï¼ˆé€‚åˆåŠ¨ç”»ï¼‰
const handleAnimation = rafThrottle(() => {
  // åŠ¨ç”»é€»è¾‘
})
```

### 5.2 æ ¼å¼åŒ–å‡½æ•°

```typescript
import * as format from '@/utils/format'

// æ—¥æœŸæ ¼å¼åŒ–
format.formatDate(new Date(), 'YYYY-MM-DD HH:mm:ss')
// è¾“å‡º: 2026-02-07 14:30:00

// ç›¸å¯¹æ—¶é—´
format.formatRelativeTime(new Date(Date.now() - 3600000))
// è¾“å‡º: 1å°æ—¶å‰

// æ•°å­—æ ¼å¼åŒ–
format.formatNumber(1234567.89)
// è¾“å‡º: 1,234,567.89

// è´§å¸æ ¼å¼åŒ–
format.formatCurrency(1234.56)
// è¾“å‡º: Â¥1,234.56

// æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
format.formatFileSize(1024000)
// è¾“å‡º: 1.00 MB

// æ‰‹æœºå·æ ¼å¼åŒ–
format.formatPhone('13812345678')
// è¾“å‡º: 138****5678
```

### 5.3 éªŒè¯å‡½æ•°

```typescript
import * as validate from '@/utils/validate'

// éªŒè¯æ‰‹æœºå·
validate.isPhone('13812345678') // true

// éªŒè¯é‚®ç®±
validate.isEmail('test@example.com') // true

// éªŒè¯èº«ä»½è¯å·
validate.isIdCard('110101199001011234') // true

// éªŒè¯å¯†ç å¼ºåº¦
validate.getPasswordStrength('Abc123!@')
// è¿”å›: 4 (æœ€å¼º)

// è·å–èº«ä»½è¯ä¿¡æ¯
const info = validate.getIdCardInfo('110101199001011234')
// è¿”å›: { valid: true, gender: 'ç”·', birthDate: '1990-01-01', age: 35 }
```

### 5.4 UI å·¥å…·å‡½æ•°

```typescript
import * as ui from '@/utils/ui'

// æ˜¾ç¤ºæç¤º
ui.showSuccess('æ“ä½œæˆåŠŸ')
ui.showErrorToast('æ“ä½œå¤±è´¥')
ui.showToast('æç¤ºä¿¡æ¯')

// æ˜¾ç¤ºå¯¹è¯æ¡†
const confirmed = await ui.showConfirm('ç¡®è®¤åˆ é™¤?', 'æ­¤æ“ä½œä¸å¯æ¢å¤')
if (confirmed) {
  // ç”¨æˆ·ç‚¹å‡»ç¡®å®š
}

// å¯¼èˆª
await ui.navigateTo('/pages/user/detail', { id: 1 })
await ui.redirectTo('/pages/login')
await ui.switchTab('/pages/index')
await ui.navigateBack()

// å¤åˆ¶åˆ°å‰ªè´´æ¿
await ui.setClipboardData('å¤åˆ¶çš„å†…å®¹')

// é€‰æ‹©å›¾ç‰‡
const images = await ui.chooseImage({ count: 9 })
```

---

## å…­ã€é…ç½®ç®¡ç†

### 6.1 ç¯å¢ƒåˆ¤æ–­

```typescript
import { isDev, isProd, isTest } from '@/config/env'

if (isDev()) {
  console.log('å¼€å‘ç¯å¢ƒ')
}

if (isProd()) {
  console.log('ç”Ÿäº§ç¯å¢ƒ')
}
```

### 6.2 å¹³å°åˆ¤æ–­

```typescript
import { isWeixinMp, isH5, isApp, getPlatform } from '@/config/env'

// åˆ¤æ–­å¹³å°
if (isWeixinMp()) {
  console.log('å¾®ä¿¡å°ç¨‹åº')
}

if (isH5()) {
  console.log('H5')
}

if (isApp()) {
  console.log('App')
}

// è·å–å¹³å°æ ‡è¯†
const platform = getPlatform()
console.log(platform) // 'mp-weixin' | 'h5' | 'app-plus'
```

### 6.3 å±å¹•é€‚é…

```typescript
import { rpxToPx, pxToRpx, getScreenWidth, getScreenHeight } from '@/config/env'

// rpx è½¬ px
const pxValue = rpxToPx(750) // å±å¹•å®½åº¦

// px è½¬ rpx
const rpxValue = pxToRpx(375) // åŠå±å®½åº¦

// è·å–å±å¹•å°ºå¯¸
const width = getScreenWidth()
const height = getScreenHeight()
```

### 6.4 å¸¸é‡ä½¿ç”¨

```typescript
import {
  STORAGE_KEYS,
  HTTP_STATUS,
  ERROR_CODE,
  REGEX,
  DATE_FORMAT,
  CACHE_TTL,
  APP_EVENTS
} from '@/config/constant'

// å­˜å‚¨é”®å
Storage.set(STORAGE_KEYS.TOKEN, 'abc123')

// HTTP çŠ¶æ€ç 
if (response.code === HTTP_STATUS.SUCCESS) {
  // æˆåŠŸ
}

// é”™è¯¯ç 
if (error.code === ERROR_CODE.TOKEN_EXPIRED) {
  // Token è¿‡æœŸ
}

// æ­£åˆ™è¡¨è¾¾å¼
if (REGEX.PHONE.test(phoneNumber)) {
  // æœ‰æ•ˆçš„æ‰‹æœºå·
}

// æ—¥æœŸæ ¼å¼
format.formatDate(new Date(), DATE_FORMAT.DATETIME)

// ç¼“å­˜æ—¶é—´
Storage.set('key', value, { expire: CACHE_TTL.LONG })

// åº”ç”¨äº‹ä»¶
eventBus.emit(APP_EVENTS.USER_LOGIN, userInfo)
```

---

## ä¸ƒã€å®Œæ•´ç¤ºä¾‹

### 7.1 ç”¨æˆ·ç™»å½•ç¤ºä¾‹

```typescript
import { httpRequest } from '@/utils'
import Storage from '@/utils/storage'
import { STORAGE_KEYS, ERROR_CODE } from '@/config/constant'
import { showSuccess, showErrorToast } from '@/utils/ui'
import type { LoginParams, LoginResponse } from '@/types'

async function login(params: LoginParams) {
  try {
    // å‘èµ·ç™»å½•è¯·æ±‚
    const response = await httpRequest.post<LoginResponse>('/auth/login', params, {
      showLoading: true,
      loadingText: 'ç™»å½•ä¸­...'
    })

    if (response.code === 200) {
      const { token, refreshToken, userInfo } = response.data

      // å­˜å‚¨ Token
      await Storage.set(STORAGE_KEYS.TOKEN, token, {
        expire: 7 * 24 * 60 * 60 * 1000 // 7 å¤©
      })

      // å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
      await Storage.set(STORAGE_KEYS.USER_INFO, userInfo)

      showSuccess('ç™»å½•æˆåŠŸ')
      return userInfo
    } else {
      showErrorToast(response.message)
      return null
    }
  } catch (error: any) {
    if (error.code === ERROR_CODE.PASSWORD_ERROR) {
      showErrorToast('å¯†ç é”™è¯¯')
    } else {
      showErrorToast('ç™»å½•å¤±è´¥')
    }
    return null
  }
}
```

### 7.2 æ•°æ®åˆ—è¡¨ç¤ºä¾‹

```typescript
import { httpRequest, debounce } from '@/utils'
import { CacheManager } from '@/utils'
import type { PageResponse, ProductInfo } from '@/types'

// åˆ›å»ºåˆ—è¡¨ç¼“å­˜
const listCache = new CacheManager({ maxSize: 20 })

// è·å–å•†å“åˆ—è¡¨
async function getProductList(page: number, pageSize: number) {
  const cacheKey = `products:${page}:${pageSize}`

  // å…ˆä»ç¼“å­˜è·å–
  const cached = listCache.get<PageResponse<ProductInfo>>(cacheKey)
  if (cached) {
    return cached
  }

  // ä»æœåŠ¡å™¨è·å–
  const response = await httpRequest.get<PageResponse<ProductInfo>>('/products', {
    page,
    pageSize
  }, {
    cache: 60000 // ç¼“å­˜ 1 åˆ†é’Ÿ
  })

  // å­˜å…¥ç¼“å­˜
  listCache.set(cacheKey, response.data, 60000)

  return response.data
}

// æœç´¢å•†å“ï¼ˆé˜²æŠ–ï¼‰
const searchProducts = debounce(async (keyword: string) => {
  const response = await httpRequest.get('/products/search', { keyword })
  return response.data
}, 500)
```

---

## å…«ã€æœ€ä½³å®è·µ

### 8.1 é”™è¯¯å¤„ç†

```typescript
import { httpRequest } from '@/utils'
import { showErrorToast } from '@/utils/ui'
import { HTTP_STATUS } from '@/config/constant'

try {
  const response = await httpRequest.get('/api/data')
  // å¤„ç†æˆåŠŸå“åº”
} catch (error: any) {
  // æ ¹æ®é”™è¯¯ç±»å‹å¤„ç†
  switch (error.statusCode) {
    case HTTP_STATUS.UNAUTHORIZED:
      // Token è¿‡æœŸï¼Œè·³è½¬ç™»å½•
      uni.navigateTo({ url: '/pages/login/index' })
      break
    case HTTP_STATUS.FORBIDDEN:
      showErrorToast('æ²¡æœ‰æƒé™')
      break
    case HTTP_STATUS.NOT_FOUND:
      showErrorToast('èµ„æºä¸å­˜åœ¨')
      break
    default:
      showErrorToast(error.message || 'è¯·æ±‚å¤±è´¥')
  }
}
```

### 8.2 æ€§èƒ½ä¼˜åŒ–

```typescript
import { throttle, memoize } from '@/utils'
import { globalCache } from '@/utils'

// 1. ä½¿ç”¨èŠ‚æµå‡å°‘å‡½æ•°è°ƒç”¨é¢‘ç‡
const handleScroll = throttle(() => {
  // æ»šåŠ¨å¤„ç†é€»è¾‘
}, 100)

// 2. ç¼“å­˜å‡½æ•°ç»“æœ
const expensiveCalculation = memoize((data: any) => {
  // è€—æ—¶è®¡ç®—
  return result
})

// 3. ä½¿ç”¨å…¨å±€ç¼“å­˜
globalCache.set('calculation:result', result, 30000)

// 4. åˆ†æ‰¹å¤„ç†å¤§é‡æ•°æ®
import { batchExecute } from '@/utils'
const results = await batchExecute(largeArray, 100, async (item) => {
  return await processItem(item)
})
```

### 8.3 ç±»å‹å®‰å…¨

```typescript
import type { UserInfo, ApiResponse } from '@/types'

// æ˜ç¡®æŒ‡å®šè¿”å›ç±»å‹
async function getUserInfo(id: number): Promise<UserInfo | null> {
  const response = await httpRequest.get<ApiResponse<UserInfo>>(`/user/${id}`)

  if (response.code === 200) {
    return response.data
  }

  return null
}

// ä½¿ç”¨æ³›å‹
async function fetchData<T>(url: string): Promise<T | null> {
  const response = await httpRequest.get<ApiResponse<T>>(url)
  return response.code === 200 ? response.data : null
}
```

---

**æ–‡æ¡£ç»´æŠ¤**: è¯·éšç€é¡¹ç›®å‘å±•åŠæ—¶æ›´æ–°æœ¬æ–‡æ¡£

**ç›¸å…³æ–‡æ¡£**:
- [Uniappå¼€å‘æ‰‹å†Œ-æ¶æ„ä¸æœ€ä½³å®è·µ.md](./Uniappå¼€å‘æ‰‹å†Œ-æ¶æ„ä¸æœ€ä½³å®è·µ.md)
- [APIæ¥å£æ‰‹å†Œ-å°ç¨‹åºç»‘å®šåŠŸèƒ½.md](./APIæ¥å£æ‰‹å†Œ-å°ç¨‹åºç»‘å®šåŠŸèƒ½.md)
